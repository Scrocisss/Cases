# File Sharing

### Task
Use netcat to share the file /confidential.txt on port 9000 so it can be downloaded by another user on the same network.
Keep in mind that sharing should work even after you log out of SSH. (You can use nohup or screen to persist commands between sessions)

### Theory
Netcat (nc) is a versatile command-line networking tool used for reading and writing data over network connections. It can act as a TCP/UDP client or server, making it useful for tasks like port scanning, file transfers, and debugging.

### Common Uses:
Listen for incoming connections (act as a server):

```bash
nc -l -p 1234
```

Connect to a remote server (act as a client):

```bash
nc 192.168.1.100 1234
```

Send a file over a network:

```bash
nc -l -p 1234 < file.txt  # listens on port 1234 and sends the content of file.txt to any client that connects
nc host 1234 > file.txt   # connects to the host on port 1234 and saves the received data into the file file.txt
```

Port scanning:

```bash
nc -zv 192.168.1.1 80-443
```

Transfer text between machines:

```bash
echo "Hello" | nc 192.168.1.100 1234
```

Netcat is often called the "Swiss Army knife" of networking because of its flexibility and simplicity.

### Solve

```bash
root@Network-challenges:~# cd /
root@Network-challenges:/# ls
bin   confidential.txt  dev  home  lib32  libx32      media  opt   project_shared  run   snap  sys  usr
boot  defbox-course     etc  lib   lib64  lost+found  mnt    proc  root            sbin  srv   tmp  var
root@Network-challenges:/# nohup nc -l -p 9000 < confidential.txt &
[2] 1347
root@Network-challenges:/# nohup: appending output to 'nohup.out'

root@Network-challenges:/# ps
    PID TTY          TIME CMD
   1315 pts/0    00:00:00 bash
   1347 pts/0    00:00:00 nc
   1348 pts/0    00:00:00 ps
```

### Tip

It's important to monitor for any unexpected running instances of "nc" on production hosts to detect unauthorized network connections or data transfers.

# Share several files

### Task

Share all files from /project_shared directory. You can use the python -m http.server 8080 for such purpose.
Keep in mind that sharing should work even after you log out. (You can use nohup or screen to persist commands between sessions)

### Solve

```bash
root@Network-challenges:~# cd /project_shared
root@Network-challenges:/project_shared# nohup python3 -m http.server 8080 &
[1] 1575
root@Network-challenges:/project_shared# nohup: ignoring input and appending output to 'nohup.out'

root@Network-challenges:/project_shared# ps
    PID TTY          TIME CMD
   1560 pts/0    00:00:00 bash
   1575 pts/0    00:00:00 python3
   1754 pts/0    00:00:00 ps
root@Network-challenges:/project_shared# 
```

### Tip

To see the listening ports, run: "ss -tulpn"

# Configure IP Filtering with IPTables

### Task
Forbid all incoming connections (including those to localhost) except for the ports 22 and 80. The command nc -zv 127.0.0.1 80 should be successful, while the command nc -zv 127.0.0.1 81 should not.

### Theory
iptables is a command-line utility in Linux used to configure the netfilter firewall for managing network traffic based on rules. It controls packet filtering, NAT (Network Address Translation), and packet mangling.

### Key Features:
Works with tables such as filter, nat, and mangle.
Uses chains like INPUT, OUTPUT, and FORWARD to process packets.
Each rule specifies criteria (e.g., IP, port) and an action (e.g., ACCEPT, DROP).

### Basic Commands:

View current rules:

```bash
sudo iptables -L -v
```

Allow incoming SSH traffic:

```bash
sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
```

Block an IP address:

```bash
sudo iptables -A INPUT -s 192.168.1.100 -j DROP
```

Save rules (persistent after reboot):
```bash
sudo iptables-save > /etc/iptables/rules.v4
```

iptables is now being replaced by nftables, but it remains widely used for packet filtering and security.

### Solve

Блокнул себе пару раз ssh, ну ладно, после 10ти ребутов:

```bash
root@Network-challenges:~# sudo iptables -F
root@Network-challenges:~# sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
root@Network-challenges:~# sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
root@Network-challenges:~# sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
root@Network-challenges:~# sudo iptables -P INPUT DROP
root@Network-challenges:~# sudo iptables -P FORWARD DROP
root@Network-challenges:~# sudo iptables -P OUTPUT ACCEPT
root@Network-challenges:~# iptables-save
# Generated by iptables-save v1.8.7 on Thu Aug 14 12:57:13 2025
*filter
:INPUT DROP [6:426]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [19:2052]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
COMMIT
# Completed on Thu Aug 14 12:57:13 2025
root@Network-challenges:~# nc -zv 127.0.0.1 80
Connection to 127.0.0.1 80 port [tcp/http] succeeded!
root@Network-challenges:~# nc -zv 127.0.0.1 81
^C
root@Network-challenges:~#
```




